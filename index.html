<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>We Become What We Behold ‚Äî Clone (single file)</title>
<style>
  :root{--bg:#0f1724;--panel:#0b1220;--muted:#9aa4b2;--accent:#ffd166;--danger:#ff6b6b}
  *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#071022 0%, #081226 60%);color:#e6eef8}
  .app{display:flex;flex-direction:column;height:100vh;padding:14px;gap:12px}
  header{display:flex;align-items:center;gap:12px}
  h1{font-size:18px;margin:0}
  .main{display:grid;grid-template-columns:1fr 360px;gap:12px;flex:1;min-height:0}
  @media(max-width:880px){.main{grid-template-columns:1fr}.side{order:2}}
  .world{background:linear-gradient(180deg,#112034,#081225);border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:10px}
  .square{background:#061017;border-radius:8px;padding:10px;flex:1;display:flex;flex-direction:column}
  .stage{flex:1;border-radius:10px;background:linear-gradient(180deg,#0b1622,#09121a);padding:10px;display:grid;grid-template-columns:repeat(6,1fr);grid-auto-rows:84px;gap:10px;align-content:start}
  .npc{display:flex;align-items:center;justify-content:center;border-radius:8px;background:rgba(255,255,255,0.03);font-size:24px;user-select:none;position:relative}
  .npc .mood{position:absolute;top:6px;right:6px;font-size:12px;opacity:0.9}
  .screen{height:140px;border-radius:8px;background:#001528;display:flex;align-items:center;justify-content:center;font-size:20px;color:var(--accent);flex-direction:column}
  .controls{display:flex;gap:8px;align-items:center}
  button{background:linear-gradient(180deg,#0f3a5a,#0b2a44);border:0;padding:10px 12px;border-radius:8px;color:#e6f0ff;font-weight:600;cursor:pointer}
  button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);font-weight:500}
  .hud{display:flex;gap:8px;align-items:center}
  .log{font-size:13px;color:var(--muted);max-height:92px;overflow:auto;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02)}
  footer{font-size:12px;color:var(--muted)}
  .big{font-size:34px;font-weight:800}
  .end{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;padding:16px}
  .progress{height:10px;background:rgba(255,255,255,0.05);border-radius:8px;overflow:hidden}
  .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#ffd28c);width:0%}
  .credit{font-size:12px;color:var(--muted)}
  /* touch targets */
  .btn-large{padding:12px 16px;font-size:15px}
</style>
</head>
<body>
<div class="app">
  <header>
    <h1>We Become What We Behold ‚Äî Clone</h1>
    <div class="credit">Prototype autonome ‚Äî Ouvrir le fichier dans un navigateur (desktop & mobile)</div>
  </header>

  <div class="main">
    <div class="world">
      <div class="square">
        <div class="screen" id="screen">Aucun clich√© ‚Äî Appuie pour photographier</div>
        <div class="controls">
          <button id="snap" class="btn-large">Prendre une photo</button>
          <button id="nextScene" class="secondary">Afficher sur l'√©cran</button>
          <div style="flex:1"></div>
          <div class="hud">
            <div>Score: <span id="score">0</span></div>
            <div style="width:120px">
              <div class="progress" aria-hidden><i id="meter"></i></div>
            </div>
          </div>
        </div>
        <div class="stage" id="stage" aria-hidden>
          <!-- NPCs injected by JS -->
        </div>
      </div>
    </div>

    <aside class="side">
      <div class="square">
        <h2 style="font-size:15px;margin:0">Journal</h2>
        <div class="log" id="log"></div>
        <div style="margin-top:8px;display:flex;gap:8px">
          <button id="reset" class="secondary">R√©initialiser</button>
          <button id="auto" class="secondary">Auto-play</button>
        </div>
        <div style="margin-top:10px;font-size:13px;color:var(--muted)">Touches: Espace = photo ‚Ä¢ C = afficher</div>
      </div>
      <div class="square" style="margin-top:12px">
        <h3 style="margin:0 0 8px 0">Explication</h3>
        <div style="font-size:13px;color:var(--muted)">Tu incarnes un cam√©raman. Prends des photos, diffuse-les et observe l'effet sur la population. Le jeu illustre comment la r√©p√©tition d'images fa√ßonne les comportements.</div>
      </div>
    </aside>
  </div>

  <footer>
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div class="credit">Fichier autonome ‚Äî Compatible mobile</div>
      <div id="status" style="font-size:13px;color:var(--muted)"></div>
    </div>
  </footer>
</div>

<script>
/* -------------------------------
   Version simplifi√©e et autonome
   - Pas de d√©pendances externes
   - Support click/touch & clavier
   - NPCs r√©agissent selon les clich√©s
   - Escalade et fin
   -------------------------------*/

const NPC_COUNT = 18;
const stage = document.getElementById('stage');
const screen = document.getElementById('screen');
const logEl = document.getElementById('log');
const scoreEl = document.getElementById('score');
const meterEl = document.getElementById('meter');
const snapBtn = document.getElementById('snap');
const nextBtn = document.getElementById('nextScene');
const resetBtn = document.getElementById('reset');
const autoBtn = document.getElementById('auto');
let autoPlay = false;

// √©tat du jeu
let npcs = [];
let currentShot = null;
let score = 0;
let escalation = 0; // 0..100
let tick = 0;
let ended = false;

const IMAGES = [
  {id:'happy', label:'Sourire üòä', effect:{mood:'happy', delta:2, note:'Image joyeuse'}},
  {id:'loner', label:'Solitude üòî', effect:{mood:'sad', delta:3, note:'Quelqu‚Äôun seul'}},
  {id:'argue', label:'Dispute üò°', effect:{mood:'angry', delta:8, note:'Bagarre visible'}},
  {id:'weird', label:'Bizarre ü§®', effect:{mood:'curious', delta:4, note:'Sc√®ne √©trange'}},
  {id:'hero', label:'H√©ros üèÖ', effect:{mood:'admire', delta:3, note:'Geste h√©ro√Øque'}},
  {id:'panic', label:'Panique ü´¢', effect:{mood:'panicked', delta:10, note:'Comportement effrayant'}}
];

// initialisation des NPCs
function initNPCs(){
  npcs = [];
  stage.innerHTML = '';
  for(let i=0;i<NPC_COUNT;i++){
    const mood = 'neutral';
    const el = document.createElement('div');
    el.className = 'npc';
    el.dataset.idx = i;
    el.dataset.mood = mood;
    el.innerHTML = randomEmoji() + '<div class="mood">' + mood + '</div>';
    el.addEventListener('click', () => inspectNPC(i));
    stage.appendChild(el);
    npcs.push({el,mood,aggression:0});
  }
}

function randomEmoji(){
  const set = ['üôÇ','üòê','üò¥','üò¨','ü§ì','ü´°','üßê','üòÆ'];
  return set[Math.floor(Math.random()*set.length)];
}

// log
function log(msg){
  const p = document.createElement('div');
  p.textContent = msg;
  logEl.prepend(p);
  while(logEl.children.length>80) logEl.removeChild(logEl.lastChild);
}

// prendre une photo: on choisit une image al√©atoire (ou par pattern)
function takePhoto(){
  if(ended) return;
  currentShot = IMAGES[Math.floor(Math.random()*IMAGES.length)];
  screen.innerHTML = '<div style="font-size:16px">Photo prise:</div><div class="big">'+currentShot.label+'</div>';
  log('Photo: ' + currentShot.label + ' ‚Äî ' + currentShot.effect.note);
}

// diffuser la photo: influence les NPCs
function publish(){
  if(!currentShot || ended) return;
  const e = currentShot.effect;
  // s√©lectionner quelques NPCs affect√©s (varie selon l'intensit√©)
  const count = 2 + Math.floor(Math.random()*5);
  const indices = sampleIndices(count);
  indices.forEach(i=>applyEffectToNPC(i,e));
  // accro√Ætre l'escalade
  escalation += e.delta + Math.floor(Math.random()*3);
  score += e.delta;
  updateUI();
  log('Diffusion: ' + currentShot.label + ' ‚Äî impact sur ' + indices.length + ' personnes');
  currentShot = null;
  screen.innerHTML = 'Aucun clich√© ‚Äî Appuie pour photographier';
  checkEnd();
}

function sampleIndices(n){
  const arr = Array.from({length:NPC_COUNT},(_,i)=>i);
  // pond√©ration: certains plus influen√ßables
  shuffle(arr);
  return arr.slice(0,n);
}

function applyEffectToNPC(i,e){
  const npc = npcs[i];
  // augmenter agressivit√© ou changer mood
  if(e.mood === 'angry' || e.mood==='panicked'){
    npc.aggression += Math.max(2, Math.floor(e.delta/2));
  } else if(e.mood==='sad'){
    npc.aggression += 1;
  } else if(e.mood==='admire'){
    npc.aggression = Math.max(0, npc.aggression-1);
  }
  // update visible
  npc.mood = e.mood;
  renderNPC(npc);
}

function renderNPC(npc){
  // visual representation selon aggression/mood
  const el = npc.el;
  el.dataset.mood = npc.mood || 'neutral';
  const face = moodEmoji(npc);
  el.innerHTML = face + '<div class="mood">' + el.dataset.mood + '</div>';
  // style selon aggression
  if(npc.aggression>=8){
    el.style.background = 'linear-gradient(180deg, rgba(255,107,107,0.12), rgba(255,107,107,0.06))';
    el.style.boxShadow = 'inset 0 0 8px rgba(255,107,107,0.08)';
  } else if(npc.aggression>=4){
    el.style.background = 'linear-gradient(180deg, rgba(255,207,92,0.06), rgba(255,207,92,0.02))';
  } else {
    el.style.background = 'rgba(255,255,255,0.03)';
    el.style.boxShadow = 'none';
  }
}

function moodEmoji(npc){
  if(npc.aggression>=10) return 'üî•';
  switch(npc.mood){
    case 'happy': return 'üòÑ';
    case 'sad': return 'üòü';
    case 'angry': return 'üò†';
    case 'curious': return 'üßê';
    case 'admire': return 'ü§©';
    case 'panicked': return 'üò±';
    default: return randomEmoji();
  }
}

function updateUI(){
  scoreEl.textContent = score;
  const pct = Math.min(100, escalation);
  meterEl.style.width = pct + '%';
}

function checkEnd(){
  if(escalation>=90 && !ended){
    ended = true;
    endSequence();
  }
}

function endSequence(){
  // transformer l'√©cran en message final
  screen.innerHTML = '<div class="big">LA TENSION EXPLOSE</div><div style="margin-top:8px;color:var(--muted)">Nous sommes ce que nous regardons.</div>';
  // intensifier les NPCs
  npcs.forEach(n=>{ n.aggression = Math.max(n.aggression, 8); renderNPC(n); });
  log('Fin: Escalade maximale ‚Äî message final affich√©');
}

function inspectNPC(i){
  const npc = npcs[i];
  log('Inspection: personne #' + i + ' ‚Äî humeur: ' + npc.mood + ', agressivit√©: ' + npc.aggression);
}

function reset(){
  escalation = 0; score = 0; currentShot = null; ended = false; tick=0;
  screen.innerHTML = 'Aucun clich√© ‚Äî Appuie pour photographier';
  initNPCs(); updateUI(); log('Partie r√©initialis√©e');
}

// utilitaires
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] }}

function sample(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

function shuffleInplace(a){shuffle(a);return a}

function clamp(v,a,b){return Math.max(a,Math.min(b,v))}

// clavier et interactions
snapBtn.addEventListener('click', takePhoto);
nextBtn.addEventListener('click', publish);
resetBtn.addEventListener('click', reset);
autoBtn.addEventListener('click', ()=>{autoPlay=!autoPlay; autoBtn.textContent = autoPlay? 'Auto-play: ON' : 'Auto-play'});

window.addEventListener('keydown', (e)=>{
  if(e.code==='Space') { e.preventDefault(); takePhoto(); }
  if(e.key==='c' || e.key==='C') publish();
});

// support tactile: tap the stage to inspect or long-press? We already added click handlers on NPCs.

// boucle de simulation: petit pas, propagation sociale
function step(){
  tick++;
  // contagion: les NPCs influencent leurs voisins
  for(let i=0;i<npcs.length;i++){
    const n = npcs[i];
    // si agressif, chance d'augmenter voisins' aggression
    if(n.aggression>3){
      const neighbors = neighborIndices(i,2);
      neighbors.forEach(j=>{
        if(Math.random()<0.08 + n.aggression*0.01){
          npcs[j].aggression += 1;
          // mood shift toward anger if aggression high
          if(npcs[j].aggression>4) npcs[j].mood = 'angry';
          renderNPC(npcs[j]);
        }
      });
    }
    // decay: petit retour √† la normale
    if(n.aggression>0 && Math.random()<0.02) { n.aggression = Math.max(0,n.aggression-1); renderNPC(n); }
  }
  // progression naturelle: escalade augmente l√©g√®rement avec le temps
  if(!ended && Math.random()<0.02) { escalation += 0.2; updateUI(); }

  // auto-play option: prend et publie automatiquement
  if(autoPlay && !ended){
    if(Math.random()<0.24) takePhoto();
    if(currentShot && Math.random()<0.45) publish();
  }

  // check end condition
  if(!ended && escalation>=90) checkEnd();
}

function neighborIndices(i,r){
  // simple proximit√© sur grille 6 colonnes
  const cols = 6; const row = Math.floor(i/cols); const col = i%cols; const res=[];
  for(let dr=-r;dr<=r;dr++) for(let dc=-r;dc<=r;dc++){
    const rr=row+dr; const cc=col+dc; if(rr<0||cc<0) continue; const idx=rr*cols+cc; if(idx>=0 && idx<npcs.length && idx!==i) res.push(idx);
  }
  return res;
}

// d√©marrage
initNPCs(); updateUI(); log('Jeu pr√™t ‚Äî prends des photos et observe');
setInterval(step, 700);

</script>
</body>
</html>
